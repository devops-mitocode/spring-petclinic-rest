pipeline {
  agent none
  options { timestamps() }

  environment {
    LOG_FILE = "build.log"
  }

  stages {

    stage('Build (Maven)') {
      agent {
        docker {
          image 'maven:3.9.9-eclipse-temurin-17-alpine'
          reuseNode true
        }
      }
      steps {
        script {
          // Ejecutamos mal a propÃ³sito pero no detenemos el pipeline
          // catchError(buildResult: 'FAILURE', stageResult: 'FAILURE') {
          //   sh """
          //     echo "Running Maven with typo..."
          //     mvn -U -B -ntp clean packag 2>&1 | tee ${LOG_FILE}
          //   """
          // }
          sh "mvn -U -B -ntp clean package"
        }
      }
    }

    stage('AI Agent Analysis') {
      agent {
        docker {
          image 'ghcr.io/supportpal/github-gh-cli:latest'
          reuseNode true
        }
      }
      steps {
        sh """
          gh --version
        """
      }
    }
  }
}