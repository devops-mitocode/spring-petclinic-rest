pipeline {
  agent none
  environment {
    GH_TOKEN = credentials('github-cli-token')
  }
  stages {
    stage('AI Agent Analysis') {
      agent {
        docker {
          image 'ghcr.io/supportpal/github-gh-cli:2.87.3'
          args '-e HOME=/tmp'
        }
      }
      steps {
        sh '''
          env | sort

          gh auth status

          gh extension install github/gh-copilot || true

          gh copilot --help

          gh copilot --prompt "Explica el Jenkinsfile"
        '''        
      }
    }
  }
}